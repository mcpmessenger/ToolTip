version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ðŸš€ Starting ToolTip Companion Chrome Extension build..."
        - echo "ðŸ“¦ Installing frontend dependencies..."
        - cp package-amplify.json package.json
        - rm -f package-lock.json || true
        - npm install --legacy-peer-deps
        - echo "âœ… Frontend dependencies installed"
    build:
      commands:
        - echo "ðŸ—ï¸ Building frontend..."
        - npm run build
        - echo "ðŸ“¦ Installing backend dependencies..."
        - cd backend
        - cp package-amplify.json package.json
        - rm -f package-lock.json || true
        - npm install --legacy-peer-deps
        - echo "âœ… Backend dependencies installed"
        - echo "ðŸ—ï¸ Building backend..."
        - npm run build
        - cd ..
        - echo "ðŸ“ Creating deployment structure..."
        - mkdir -p dist/backend
        - cp -r backend/dist/* dist/backend/
        - cp backend/package.json dist/backend/
        - echo "ðŸ“‹ Copying server.js..."
        - cp dist/server.js dist/server.js 2>/dev/null || echo "Using existing server.js"
    postBuild:
      commands:
        - echo "âœ… Build completed successfully!"
        - echo "ðŸ“Š Build artifacts ready for deployment"
        - echo "ðŸ”Œ Chrome Extension build ready"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - backend/node_modules/**/*
